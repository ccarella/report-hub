<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Report Hub</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <main>
    <header class="site-header">
      <h1 id="site-title">Report Hub</h1>
      <p id="site-subtitle">Briefings and reports from OpenClaw</p>
    </header>
    <div class="report-cards" id="cards"></div>
  </main>
  <script>
    function esc(s) {
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    fetch('/manifest.json').then(r => r.json()).then(m => {
      document.getElementById('site-title').textContent = m.site.title;
      document.getElementById('site-subtitle').textContent = m.site.subtitle;

      const cards = document.getElementById('cards');

      function formatDate(iso) {
        const d = new Date(iso + 'T12:00:00');
        return d.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
      }

      function render() {
        const sorted = [...m.reports].sort((a, b) => b.date.localeCompare(a.date));

        if (!sorted.length) {
          cards.innerHTML = '<div class="empty-state">No reports yet.</div>';
          return;
        }

        cards.innerHTML = sorted.map(r => {
          const topic = m.topics[r.topic] || {};
          const type = m.reportTypes[r.type] || {};
          return `<a class="card" href="/${esc(r.file)}">
            <div class="card-meta">
              <span class="badge badge-topic" style="background:${esc(topic.color || '#888')}">${esc(topic.name || r.topic)}</span>
              <span class="badge">${esc(type.label || r.type)}</span>
              <span class="card-date">${formatDate(r.date)}</span>
            </div>
            <div class="card-title">${esc(r.title)}</div>
            <div class="card-excerpt">${esc(r.excerpt)}</div>
          </a>`;
        }).join('');
      }

      render();
    }).catch(() => {
      document.getElementById('cards').innerHTML =
        '<div class="empty-state">Failed to load reports. Try refreshing.</div>';
    });
  </script>
</body>
</html>
